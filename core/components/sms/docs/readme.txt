--------------------
SMS
--------------------
Автор: -=crow=- <gavoronok30@gmail.com>
--------------------

Компонент для отправки смс сообщений + отправки кодов подтверждений по смс

--------------------

В данный момент, из коробки, поддерживаются сервисы:
- turbosms.ua (используется SOAP)
- smsc.ru

Для отслеживания сообщений turbosms.ua, необходимо в системную настройку sms_extra вставить JSON:
{"loginText":"Вы успешно авторизировались","sendText":"Сообщения успешно отправлены"}

--------------------

Использовать компонент можно в любом сниппете, классе или хуке.
Загрузка компонента производится:
- $modx->getService('sms', 'sms', MODX_CORE_PATH . 'components/sms/model/sms/'); // загрузка компонента
- $modx->sms->initialize(); // инициализация сервиса для отправки смс


Методы для работы с компонентом:

--- отправка обычного смс:
$response = $modx->sms->sendSms($text, $phones, $options);
- $text: текст смс (string) (обязательно)
- $phones: номер телефона или если сервис позволяет, то несколько телефонов (через запятую) на которые необходимо отправить данное смс (string) (обязательно)
- $options: массив опций (array)
Возвращает массив:
Array
(
    [id] => 189 // ID сообщения на сервисе
    [response] => Array // ответ с сервиса
        (
            [id] => 189
            [cnt] => 1
        )

    [code] => send_sms // системный код результата отправки смс
    [success] => 1 // отправлено или нет
    [message] => Сообщение успешно отправлено // текст используется при ошибке и успехе
)

--- отправка кода в смс:
$response = $modx->sms->sendCode($tpl, $phone, $mode);
- $tpl: название чанка для смс, в котором присутствует плейсхолдер [[+code]] (string)
- $phone: номер телефона на который необходимо отправить данное смс (string) (обязательно)
- $mode: кастомное значение (ниже подробнее) (string)
Возвращает массив:
Array
(
    [id] => 189 // ID сообщения на сервисе
    [response] => Array // ответ с сервиса
        (
            [id] => 192
            [cnt] => 1
        )

    [code] => send_sms // системный код результата отправки смс
    [success] => 1 // отправлено или нет
    [message] => Сообщение успешно отправлено // текст используется при ошибке и успехе
    [code_send] => 9301 // отправляемый код
)
Внимание!
- параметр $tpl, если не задан, будет использоваться чанк заданный в системных настройках
- параметр $mode является разграничивающим значением, к примеру, в него можно передавать опцию "cultureKey" или текущий контекст. Код заданый в одном режиме ($mode) не будет работать в других. С помощью режима можно разграничить: коды для регистрации, восстановления пароля, входа и тд. В таком случае, код полученный в режиме регистрации невозможно будет активировать в режиме входа или восстановления
- вид кода подтверждения настраивается в системных настройках
- в системных настройках настраивается timeout отправки кода подтверждения, в течении этого времени код действителен и его можно подтвердить
- в системных настройках настраивается кол-во попыток ввода кода до его блокировки

--- проверка введенного кода:
$response = $modx->sms->checkCode($phone, $code, $mode);
- $phone: номер телефона на который отправлялся именно этот код (string) (обязательно)
- $code: введенный пользователем код (string) (обязательно)
- $mode: кастомное значение, должно соответствовать тому значению которое было выставлено при отправке именно этого кода (string)
Возвращает массив:
Array
(
    [success] => 1 // правильный код или нет
    [message] => // сообщение
)

--- активация кода подтверждения (используется после того как прошлый запрос был выполнен успешно, для невозможности повторного ввода этого же кода)
$modx->sms->activateCode($phone, $code, $mode);
- $phone: номер телефона на который отправлялся именно этот код (string) (обязательно)
- $code: введенный пользователем код (string) (обязательно)
- $mode: кастомное значение, должно соответствовать тому значению которое было выставлено при отправке именно этого кода (string)
Ничего не возвращает